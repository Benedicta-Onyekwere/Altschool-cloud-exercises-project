---
 - name: Set php_executable variable to a default if not defined.
      set_fact:
         php_executable: php
      when: php_executable is not defined

    - name: Check if Composer is installed.
      stat: "path=/root/Altschool-cloud-exercises-project/ExamProject/usr/src/"
      register: composer_bin

    - name: Get Composer installer signature.
      uri:
        url: https://composer.github.io/installer.sig
        return_content: true
      register: composer_installer_signature
      when: not composer_bin.stat.exists

    - name: Download Composer installer.
      get_url:
        url: https://getcomposer.org/installer
        dest: /tmp/composer-installer.php
        mode: 0755
        checksum: "sha384:{{ composer_installer_signature.content }}"
      when: not composer_bin.stat.exists

    - name: Run Composer installer.
      command: >
          {{ php_executable }} composer-installer.php chdir=/tmp
      when: not composer_bin.stat.exists

    - name: Add Composer to global path
      command: >
        mv /tmp/composer.phar "/usr/local/bin/composer"  creates="/usr/local/bin/composer"
      when: not composer_bin.stat.exists

    - name: clone laravel codebase
      git:
        repo: https://github.com/f1amy/laravel-realworld-example-app.git
        dest: /var/www/miniapp
        force: yes
      become: yes

    - name: take ownership of miniapp folder
      file:
        path: /var/www/miniapp
        state: directory
        recurse: yes
        owner: www-data
        group: www-data
      become: yes


